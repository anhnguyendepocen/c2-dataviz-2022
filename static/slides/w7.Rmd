---
title: "Visualizing uncertainty"
author: "Daniel Anderson "
date: "Week 7"
output:
  xaringan::moon_reader:
    css: ["default", "new.css"]
    lib_dir: libs
    nature:
      navigation:
        scroll: false
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "https://platform.twitter.com/widgets.js"
    includes:
      in_header: "load-feather.html"
---

```{r include = FALSE, results = "asis"}
source(here::here("static", "slides", "slide-setup.R"))
```

`r setup("w7")`

---
class: inverse-blue
# Data viz in the wild

Cassie

Amy

Diana

### Errol and Mandi on deck

---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  fig.width = 13, 
  message = FALSE, 
  warning = FALSE,
  echo = TRUE,
  dev = "ragg_png"
)

library(tidyverse)
library(dviz.supp)
library(countdown)
theme_set(theme_minimal(25))

update_geom_defaults('path', list(size = 3))
update_geom_defaults('point', list(size = 4))
update_geom_defaults('text', list(size = 6))
```

# Agenda
* Finish up plot refinement slides

* Common ways of visualizing uncertainty
  + And how to implement them with {ggplot2}


--
* Framing uncertainty as relative frequencies
  + Discrete probabilities
  + Non-discrete probabilities

--
* Understanding standard errors
  + Non-standard ways of visualizing SEs


--
* HOPs (pretty quick)
  + Also bootstrapping


---
class: middle

# Agenda (continued)

Assuming we still have time (I think we will), we will also at least introduce **tables**. We probably will not have time for fonts, but I have slides for them as well in case we do.

--
* Be comfortable with the basics of `gt`
  + create a table
  + format columns
  + create spanner heads
  + etc.


--
* Understand how to use additional fonts (if you so choose)

---
class: middle

# Expectations for today

Similar to last class, we will have times for you to practice, and times where I will ask you to follow along.

Please make sure R is up and running.

---
class: middle

# A quick warning

This will be a little more stats focused than basically any lecture we have through the first three courses of this sequence

---
class: inverse-red middle

# Finishing plot refinement

---
class: inverse-blue middle

# Uncertainty

---
# Learning objectives
1. Understand there are lots of different ways to visualize uncertainty, and the best method may often be non-standard.

2. Understand how to implement basic methods, and the resources available to you to implement more advanced methods


---
# The primary problem
* When we see a point on a plot, we interpret it as **THE** value.

```{r loc_point, echo = FALSE}
ggplot(data.frame(x = -5:5, y = -5:5), aes(x, y)) +
  geom_point(data = data.frame(x = 3, y = 2),
             color = "magenta",
             size = 5) +
  geom_segment(aes(x = 5, xend = 3.2, y = 4, yend = 2.2),
               arrow = arrow(length = unit(0.5, "cm"),
                             type = "closed"),
               color = "gray40") +
  geom_vline(xintercept = 0, 
             color = "gray40",
             size = 1.4) +
  geom_hline(yintercept = 0,
             color = "gray40",
             size = 1.4) +
  scale_x_continuous(limits = c(-5, 5), breaks = seq(-5, 5, 2)) +
  scale_y_continuous(limits = c(-5, 5), breaks = seq(-5, 5, 2)) +
  coord_fixed()
```

---
# Let's have Dr. Kay explain

<br/>
<br/>

<div style="text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/E1kSnWvqCw0?start=52" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>

---
# Some secondary problems
* We're not great at understanding probabilities

* We regularly round probabilities to 100% or 0%

* As probabilities move to the tails, we're generally worse

---
# How do we typically communicate uncertainty?

--

Error bars

```{r error_bars, echo = FALSE, fig.height = 6}
ggplot(data.frame(x = -5:5, y = -5:5), aes(x, y)) +
  geom_errorbar(data = data.frame(x = 3, y = 2),
               aes(ymin = 1.5, ymax = 2.5),
               color = "gray40",
               size = 1.4) +
  geom_point(data = data.frame(x = 3, y = 2),
             color = "magenta",
             size = 5) +
  geom_vline(xintercept = 0, 
             color = "gray40",
             size = 1.4) +
  geom_hline(yintercept = 0,
             color = "gray40",
             size = 1.4) +
  scale_x_continuous(limits = c(-5, 5), breaks = seq(-5, 5, 2)) +
  scale_y_continuous(limits = c(-5, 5), breaks = seq(-5, 5, 2)) +
  coord_fixed()
```

---
# How?
### Vertical error bars
`geom_errorbar` 
* Requires `ymin` and `ymax` aesthetics
* You have to supply these - no calculation for you



--
### Horizontal error bars
`geom_errorbarh`
* Requires `xmin` and `xmax`

---
# Example

```{r mpg_se}
mpg_by_man <- mpg %>%
  group_by(manufacturer) %>%
  summarize(mean_cty = mean(cty),
            se_cty = sd(cty) / sqrt(n()))

head(mpg_by_man)
```

---
```{r mpg_plot1}
mpg_by_man %>% 
  mutate(manufacturer = fct_reorder(manufacturer, mean_cty)) %>% 
  ggplot(aes(manufacturer, mean_cty)) +
  geom_errorbar(
    aes(ymin = mean_cty + qnorm(0.025) * se_cty, 
        ymax = mean_cty + qnorm(0.975) * se_cty)
  )

```

---
# Put points on top 
### Not under

```{r mpg_plot2, fig.height = 5}
mpg_by_man %>% 
  mutate(manufacturer = fct_reorder(manufacturer, mean_cty)) %>% 
  ggplot(aes(manufacturer, mean_cty)) +
    geom_errorbar(
      aes(ymin = mean_cty + qnorm(0.025) * se_cty,
          ymax = mean_cty + qnorm(0.975) * se_cty)
    ) +
   geom_point()
```

---
```{r mpg_plot3, fig.height = 6}
mpg_by_man %>% 
  mutate(manufacturer = fct_reorder(manufacturer, mean_cty)) %>% 
  ggplot(aes(mean_cty, manufacturer)) +
    geom_errorbarh(
      aes(xmin = mean_cty - 1.96 * se_cty,
          xmax = mean_cty + 1.96 * se_cty),
      color = "gray40"
    ) +
   geom_point()
```

---
# Practice

`r countdown(minutes = 5, seconds = 0)`

* Use the Palmer penguins dataset

* Plot the mean `bill_length_mm` for each species with 95% confidence intervals

```{r }
library(palmerpenguins)
penguins 
```

---
# Solution
Or one possible solution

```{r eval = FALSE}
mn_se <- penguins %>% 
  group_by(species) %>% 
  summarize(
    mean = mean(bill_length_mm, na.rm = TRUE),
    se = sd(bill_length_mm, na.rm = TRUE) / sqrt(n()),
    lower = mean + qnorm(0.025) * se,
    upper = mean + qnorm(0.975) * se,
  ) %>% 
  mutate(species = fct_reorder(species, mean))

ggplot(mn_se, aes(mean, species)) +
  geom_errorbarh(aes(xmin = lower, xmax = upper)) +
  geom_point()
```

---
class: middle

```{r echo = FALSE}
mn_se <- penguins %>% 
  group_by(species) %>% 
  summarize(
    mean = mean(bill_length_mm, na.rm = TRUE),
    se = sd(bill_length_mm, na.rm = TRUE) / sqrt(n()),
    lower = mean + qnorm(0.025) * se,
    upper = mean + qnorm(0.975) * se,
  ) %>% 
  mutate(species = fct_reorder(species, mean))

ggplot(mn_se, aes(mean, species)) +
  geom_errorbarh(aes(xmin = lower, xmax = upper)) +
  geom_point()
```

---
# Change the height

```{r }
ggplot(mn_se, aes(mean, species)) +
  geom_errorbarh(aes(xmin = lower, xmax = upper), height = 0.2) +
  geom_point()
```

---
# Slight variant

```{r }
ggplot(mn_se, aes(mean, species)) +
  geom_linerange(aes(xmin = lower, xmax = upper)) +
  geom_point()
```

---
# Dodging

```{r props_df}
props <- mpg %>%
  count(drv, year) %>%
  mutate(prop = n / sum(n), 
         prop_se = sqrt((prop * (1 - prop)) / n))

head(props)
```

---
# Bar plot

```{r props_plot1}
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = "dodge")
```

---
# ü§¶‚Äç‚ôÇÔ∏è

```{r props_plot2, fig.height = 5}
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = "dodge") +
  geom_errorbar(
    aes(ymin = prop - 1.96 * prop_se,
        ymax = prop + 1.96 * prop_se),
    color = "gray40"
  )
```

---
```{r props_plot3, fig.height = 6}
pd <- position_dodge(.9) #<<
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = pd) + #<<
  geom_errorbar(
    aes(ymin = prop - 1.96 * prop_se,
        ymax = prop + 1.96 * prop_se),
    color = "gray40",
    position = pd #<<
  )
```

---
class: inverse-blue

background-image: url(https://media.tenor.co/images/95fa72ff808f6b601e16df7ae25e0cec/raw)
background-size: cover


---
```{r props_plot4, fig.height = 5.5}
pd <- position_dodge(.9)
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = pd) +
  geom_errorbar(
    aes(ymin = prop - 1.96 * prop_se,
        ymax = prop + 1.96 * prop_se,
        group = year #<<
    ),
    color = "gray40",
    position = pd
  )
```

---
```{r props_plot5-echo, eval = FALSE}
pd <- position_dodge(.9)
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = pd) +
  geom_errorbar(
    aes(
      ymin = ifelse(
        prop - 1.96 * prop_se < 0, #<<
        0, #<<
        prop - 1.96*prop_se
      ), #<<
      ymax = prop + 1.96 * prop_se,
      group = year
    ),
    color = "gray40",
    position = pd,
    width = 0.5, #<<
    size = 1.4 #<<
  )
```

---
class: middle

```{r props_plot5-eval, echo = FALSE}
pd <- position_dodge(.9)
ggplot(props, aes(drv, prop)) +
  geom_col(aes(fill = factor(year)), position = pd) +
  geom_errorbar(
    aes(
      ymin = ifelse(
        prop - 1.96 * prop_se < 0, #<<
        0, #<<
        prop - 1.96*prop_se
      ), #<<
      ymax = prop + 1.96 * prop_se,
      group = year
    ),
    color = "gray40",
    position = pd,
    width = 0.5, #<<
    size = 1.4 #<<
  )
```


---
# Explain error bars

Error bars could represent any of the following

* Standard deviation (of the data)

* Standard error (of the estimate)

* Confidence interval (of the estimate)


--

Possibly through a caption, make sure your audience knows what your represent.


--
If Confidence intervals, state the interval size (e.g., 68%, 90%, 95%)


---
# Thinking about uncertainty
Uncertainty means exactly what it sounds like - we are not 100% sure.

* We are nearly always uncertain of future events (forecasting)
* We can also be uncertain about past events 
  + I saw a parked car at 8 AM, but the next time I looked at 2PM it was gone. What time did it leave?
  

--
### Quantifying uncertainty
* We quantify our uncertainty mathematically using probability
* Framing probabilities as frequencies is generally more intuitive

---
class: inverse-blue center middle
# Framing a single uncertainty

---
background-image:url("https://serialmentor.com/dataviz/visualizing_uncertainty_files/figure-html/probability-waffle-1.png")
background-size:contain

---
# How do we make these?
* Start out by making a grid

```{r single-probability, options}
grid <- expand.grid(x = 1:20, y = 1:20)
head(grid)
tail(grid)
```

---
# Look at the grid

```{r see-grid}
ggplot(grid, aes(x, y)) +
  geom_tile(color = "gray40",
            fill = "white") +
  theme_void()
```

---
# Create occurrence rate
* For each sequence of `x`, create a variable that has the given occurence rate


--
### How?

--
* Plenty of options, here's one


--
## Please follow along

---
# Consider 10%
```{r prevalence1}
# create your grid
grid <- expand.grid(x = 1:20, y = 1:20)

# n to sample
n_sample <- nrow(grid) * .10

set.seed(86753098)
samp <- sample(seq_len(nrow(grid)), n_sample)
head(samp)
length(samp)
```

---
# Create the variable

```{r create_occurence}
grid <- grid %>% 
  rownames_to_column("row_id") %>% 
  mutate(event = ifelse(row_id %in% samp, "Yes", "No"))
head(grid)
```

---
# Fill in

```{r theatre1}
ggplot(grid, aes(x, y)) +
  geom_tile(aes(fill = event), color = "white") +
  theme_void()
```

---
# Customize

```{r theatre2-echo, eval = FALSE}
library(colorspace)
ggplot(grid, aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual(
    name = "Event Occurred",
    values = c(
      desaturate(lighten("#1694E8", 0.5), 0.7), 
      "#1694E8"
      )
    ) +
  coord_fixed() +
  theme_void() +
  theme(legend.position = c(0.75, 0),
        legend.direction = "horizontal",
        plot.margin = margin(b = 1, unit = "cm"))
```

---
class: middle

```{r theatre2-eval, echo = FALSE, fig.height = 9}
ggplot(grid, aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual("Event Occurred", 
                    values = c(
                      colorspace::desaturate(
                        colorspace::lighten("#1694E8", 0.5),
                      0.7),
                      "#1694E8")
                    ) +
  coord_fixed() +
  theme_void(base_size = 35) +
  theme(legend.position = "bottom",
        legend.key.size = unit(2,"line"),
        plot.margin = margin(b = 2, unit = "cm"))
```

---
# Chance of rain

```{r rain1, echo = FALSE, fig.height = 8.5}
grid <- expand.grid(x = 1:20, y = 1:20)
samp <- sample(seq_len(nrow(grid)), nrow(grid)*.80)

grid %>% 
  rownames_to_column("row_id") %>% 
  mutate(event = ifelse(row_id %in% samp, "Yes", "No")) %>% 
  ggplot(aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual("Event Occurred", 
                    values = c(
                      colorspace::desaturate(
                        colorspace::lighten("#1694E8", 0.5),
                      0.7),
                      "#1694E8")) +
  coord_fixed() +
  theme_void(base_size = 35) +
  theme(legend.position = "bottom",
        legend.key.size = unit(2,"line"),
        plot.margin = margin(b = 2, unit = "cm"))
```


---
# Vary grid size
### 10 x 10
```{r rain2, echo = FALSE}
g10 <- expand.grid(x = 1:10, y = 1:10)
g20 <- expand.grid(x = 1:20, y = 1:20)
g30 <- expand.grid(x = 1:30, y = 1:30)

samp10 <- sample(seq_len(nrow(g10)), nrow(g10)*.80)
samp20 <- sample(seq_len(nrow(g20)), nrow(g20)*.80)
samp30 <- sample(seq_len(nrow(g30)), nrow(g30)*.80)

p10 <- g10 %>% 
  rownames_to_column("row_id") %>% 
  mutate(event = ifelse(row_id %in% samp10, "Yes", "No")) %>% 
  ggplot(aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual("Event Occurred", 
                    values = c(
                      colorspace::desaturate(
                        colorspace::lighten("#1694E8", 0.5),
                      0.7),
                      "#1694E8")) +
  coord_fixed() +
  theme_void() +
  guides(fill = "none")

p20 <- g20 %>% 
  rownames_to_column("row_id") %>% 
  mutate(event = ifelse(row_id %in% samp20, "Yes", "No")) %>% 
  ggplot(aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual("Event Occurred", 
                    values = c(
                      colorspace::desaturate(
                        colorspace::lighten("#1694E8", 0.5),
                      0.7),
                      "#1694E8")) +
  coord_fixed() +
  theme_void() +
  guides(fill = "none")

p30 <- g30 %>% 
  rownames_to_column("row_id") %>% 
  mutate(event = ifelse(row_id %in% samp30, "Yes", "No")) %>% 
  ggplot(aes(x, y)) +
  geom_tile(aes(fill = event), color = "white", size = 1.4) +
  scale_fill_manual("Event Occurred", 
                    values = c(
                      colorspace::desaturate(
                        colorspace::lighten("#1694E8", 0.5),
                      0.7),
                      "#1694E8")) +
  coord_fixed() +
  theme_void() +
  guides(fill = "none")
p10 
```

---
# Vary grid size
### 20 x 20

```{r grid-size20, echo = FALSE}
p20
```

---
# Vary grid size
### 30 x 30

```{r grid-size30, echo = FALSE}
p30
```

--
Optimal size might depend on your venue

---
# Practice

* Create a new grid showing 41% likelihood of something happening

* Vary the fill colors and grid size

* Compare with a neighbor - what do you like about yours vs. theirs?

`r countdown(minutes = 5, seconds = 0)`

---
class: inverse-red center middle
# Non-discrete probabilities

---
# Hypothetical
Blue party has 1% advantage w/ margin of error of 1.76 percentage points

### Who will win and **by how much**?

--

```{r pdf, echo = FALSE, fig.height = 5.5}
# Wilke code
x <- c(seq(-2.5, 0, length.out = 50), seq(0.00001, 5, length.out = 100))
mu <- 1.02
sd <- .9

df_norm <- data.frame(
  x,
  y = dnorm(x, mu, sd),
  type = ifelse(x <= 0, "A", "B")
)

ci_x <- c(qnorm(.025, mu, sd), qnorm(0.975, mu, sd))
ci_y <- dnorm(ci_x, mu, sd)

df_annot <- data.frame(
  x = c(mu + 0.05, mu + 0.1, mu + 2.3*sd, mu - 2.5*sd),
  y = c(dnorm(mu, mu, sd) + 0.04, ci_y[1] + 0.01, 3*ci_y[1], 3*ci_y[1]),
  hjust = c(0, 0, 0.5, 0.5),
  vjust = c(1, 0, 0.5, 0.5),
  label = c("best estimate", "margin of error", "blue wins", "yellow wins")
)

ggplot(df_norm, aes(x, y)) +
  geom_area(aes(fill = type)) +
  geom_vline(xintercept = 0, linetype = 4, color = "gray50", size = 1.4) +
  geom_line() +
  geom_segment(
    data = data.frame(x = 1),
    x = ci_x[1], xend = ci_x[2], y = ci_y[1], yend = ci_y[2],
    arrow = arrow(angle = 15, length = grid::unit(15, "pt"), ends = "both", type = "closed"),
    inherit.aes = FALSE
  ) +
  geom_segment(
    data = data.frame(x = 1),
    x = mu, xend = mu, y = 0, yend = dnorm(mu, mu, sd) + 0.04,
    inherit.aes = FALSE
  ) +
  geom_text(
    data = df_annot,
    aes(x, y, label = label, hjust = hjust, vjust = vjust),
    family = dviz_font_family
  ) +
  scale_x_continuous(
    name = "percentage point advantage for blue",
    labels = scales::percent_format(accuracy = 0.1, scale = 1)
  ) +
  scale_y_continuous(
    name = NULL,
    breaks = NULL,
    expand = c(0, 0),
    limits = c(0, dnorm(mu, mu, sd) + 0.045)
  ) +
  scale_fill_manual(
    values = c(A = "#f8f1a9", B = "#b1daf4"),
    guide = "none"
  ) +
  theme_dviz_open(20, font_family = "Roboto Light")
```


---
# A bit of math
Our distribution was defined by $\mu = 1.02$ and $sd = 0.9$.

--
* What's the chance the end result is **below zero**? (yellow wins)

---
# The hard way
Calculate the exact probability

--

### The distribution

```{r dnorm, fig.height = 5}
x <- seq(-5, 5, 0.001) # some sample data
likelihood <- dnorm(x, 1.02, 0.9) # probability of occuring
sim <- data.frame(x, likelihood) 

ggplot(sim, aes(x, likelihood)) +
  geom_line(size = 1.2)
```

---
# How do we calculate this portion?

```{r auc, echo = FALSE}
x <- seq(-5, 5, 0.001)
likelihood <- dnorm(x, 1.02, 0.9)
sim <- data.frame(x, likelihood)
ggplot(sim, aes(x, likelihood)) +
  geom_area(data = filter(sim, x <= 0),
            fill = "orchid1") +
  geom_line() 
```

---
# Integrate

```{r integrate}
zab <- filter(sim, x <= 0)
pracma::trapz(zab$x, zab$likelihood)
```

---
# Easier: Simulate

```{r label, options}
random_draws <- rnorm(1e5, 1.02, 0.9)
table(random_draws > 0) / 1e5
```

---
# Problem

This approach works okay, but...

* We're not great an interpreting probabilities

* Not great at infering a probability from a density

---
# Discretized plot

```{r qqpoints1}
ppoints(50)
qnorm(ppoints(50), 1.02, 0.9)
```

---

```{r qqpoints2}
discretized <- data.frame(
  x = qnorm(ppoints(50), 1.02, 0.9)
  ) %>% 
  mutate(winner = ifelse(x <= 0, "#b1daf4", "#f8f1a9"))

head(discretized) 
tail(discretized)
```

---
```{r dotplot1}
ggplot(discretized, aes(x)) +
  geom_dotplot()
```

---
```{r dotplot2}
ggplot(discretized, aes(x)) +
  geom_dotplot(aes(fill = winner))
```

---
```{r dotplot3}
ggplot(discretized, aes(x)) +
  geom_dotplot(aes(fill = winner), binwidth = 0.35)
```

---
```{r dotplot4}
ggplot(discretized, aes(x)) +
  geom_dotplot(aes(fill = winner), binwidth = 0.35) +
  geom_vline(xintercept = 0, 
             color = "gray40", 
             linetype = "dashed", 
             size = 1.5)
```


---
```{r dotplot5, fig.height = 6}
ggplot(discretized, aes(x)) +
  geom_dotplot(aes(fill = winner), binwidth = 0.26) +
  geom_vline(xintercept = 0, 
             color = "gray40", 
             linetype = 2, 
             size = 3) +
  scale_fill_identity(guide = "none") +
  scale_y_continuous(name = "", 
                     breaks = NULL)
```

---
# Probs too many though
```{r descritized2-echo, eval = FALSE}
discretized2 <- data.frame(
  x = qnorm(ppoints(20), 1.02, 0.9)
  ) %>% 
  mutate(winner = ifelse(x <= 0, "#b1daf4", "#f8f1a9"))

ggplot(discretized2, aes(x)) +
  geom_dotplot(aes(fill = winner), binwidth = 0.4) +
  geom_vline(
    xintercept = 0.1, 
    color = "gray40", 
    linetype = 2, 
    size = 1.4) +
  scale_fill_identity(guide = "none") +
  scale_x_continuous(
    name = "",
    limits = c(-1, 3),
    labels = scales::percent_format(scale = 1)
  ) +
  theme_dviz_open(20, font_family = "Roboto Light") +
  scale_y_continuous(breaks = NULL,
                     name = "") +
  labs(caption = "Each ball represents 5% probability")
```

---
```{r descritized2-eval, echo = FALSE}
discretized2 <- data.frame(x = qnorm(ppoints(20), 1.02, 0.9)) %>% 
  mutate(winner = ifelse(x <= 0, "#b1daf4", "#f8f1a9"))

ggplot(discretized2, aes(x)) +
  geom_dotplot(aes(fill = winner), binwidth = 0.4) +
  geom_vline(xintercept = 0.1, color = "gray40", linetype = 2, size = 1.4) +
  scale_fill_identity(guide = "none") +
  scale_x_continuous(name = "", 
                     limits = c(-1, 3),
                     labels = scales::percent_format(scale = 1)) +
  theme_dviz_open(20, font_family = "Roboto Light") +
  scale_y_continuous(breaks = NULL,
                     name = "") +
  labs(caption = "Each ball represents 5% probability")
```
---
class: inverse-red center middle
# Uncertainty of point estimates

---
# Quick (hopefully) review

* What is a standard error?

--
* Standard deviation of the sampling distribution

* What is the sampling distribution?

--
* Samples from the underlying, population-based, generative distribution

* What does this mean, exactly?

--
* Let's simulate to explore

---
# Simulation

* Imagine the "real" distribution has $\mu = 100$ and $\sigma = 10$.


--
* Let's draw a sample of 10 from this distribution

--
```{r sim1}
set.seed(123)
samp10a <- rnorm(n = 10, mean = 100, sd = 10)
samp10a
```


--
* Calculate the mean

```{r mean_sim1}
mean(samp10a)
```

---
# Do it a second time

--
```{r sim2}
samp10b <- rnorm(n = 10, mean = 100, sd = 10)
samp10b

mean(samp10b)
```

---
# Do it a bunch of times

```{r sim3}
samples <- replicate(1000, rnorm(10, mean = 100, sd = 10),
                     simplify = FALSE)
samples
```

---
# Calculate all means

```{r sim3_means}
map_dbl(samples, mean) %>% 
  head()
```

--
* What's the $sd$ of these means? That's the standard error.

--
```{r sim3_sd}
map_dbl(samples, mean) %>% 
  sd()
```

---
# Sample size
Let's re-do this, pulling a sample of 100 each time.

--
```{r sim4}
samples2 <- replicate(1000, rnorm(100, mean = 100, sd = 10),
                      simplify = FALSE) 
map_dbl(samples2, mean) %>% 
  sd()
```

---
# Visualize the sampling distributions

```{r sampling_dist}
sample_means <- tibble(iter = rep(1:1000, 2),
                       sample = rep(c(10, 100), each = 1000),
                       mean = c(map_dbl(samples, mean),
                                map_dbl(samples2, mean))
                       )
sample_means
```

---
```{r sampling_dist_vis}
ggplot(sample_means, aes(mean)) +
  geom_density(aes(fill = factor(sample)), alpha = 0.3)
```

---
# Fit a model

```{r model}
m <- lm(cty ~ displ + class, mpg)
summary(m)
```

---
# Visualize with standard errors

```{r broom}
tidied_m <- broom::tidy(m, conf.int = TRUE)

tidied_m
```

---
```{r broom_viz1}
ggplot(tidied_m, aes(term, estimate)) +
  geom_hline(yintercept = 0,
             color = "cornflowerblue",
             linetype = 2) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  geom_point() +
  coord_flip()
```

---
# Multiple error bars

```{r multiple-error-echo, eval = FALSE}
library(colorspace)
ggplot(tidied_m, aes(term, estimate)) +
  geom_hline(yintercept = 0,
             color = "cornflowerblue",
             linetype = 2) +
  geom_errorbar(aes(ymin = estimate + qnorm(.025)*std.error, 
                    ymax = estimate + qnorm(.975)*std.error),
                color = lighten("#4375D3", .6),
                width = 0.2,
                size = 0.8) + # 95% CI
  geom_errorbar(aes(ymin = estimate + qnorm(.05)*std.error, 
                    ymax = estimate + qnorm(.95)*std.error),
                color = lighten("#4375D3", .3),
                width = 0.2,
                size = 1.2) + # 90% CI
  geom_errorbar(aes(ymin = estimate + qnorm(.1)*std.error, 
                    ymax = estimate + qnorm(.9)*std.error),
                color = "#4375D3",
                width = 0.2,
                size = 1.6) + # 80% CI
  geom_point() +
  coord_flip()
```

---
```{r multiple-error-eval, echo = FALSE, fig.height = 9}
library(colorspace)
ggplot(tidied_m, aes(term, estimate)) +
  geom_hline(yintercept = 0,
             color = "cornflowerblue",
             linetype = 2) +
  geom_errorbar(aes(ymin = estimate + qnorm(.025)*std.error, 
                    ymax = estimate + qnorm(.975)*std.error),
                color = lighten("#4375D3", .6),
                width = 0.2,
                size = 0.8) + # 95% CI
  geom_errorbar(aes(ymin = estimate + qnorm(.05)*std.error, 
                    ymax = estimate + qnorm(.95)*std.error),
                color = lighten("#4375D3", .3),
                width = 0.2,
                size = 1.2) + # 90% CI
  geom_errorbar(aes(ymin = estimate + qnorm(.1)*std.error, 
                    ymax = estimate + qnorm(.9)*std.error),
                color = "#4375D3",
                width = 0.2,
                size = 1.6) + # 80% CI
  geom_point() +
  coord_flip()
```

---
# Add levels to legend
```{r add_legend-echo, fig.show = "hide"}
p <- ggplot(tidied_m, aes(term, estimate)) +
  geom_hline(yintercept = 0,
             color = "cornflowerblue",
             linetype = 2) +
  geom_errorbar(aes(ymin = estimate + qnorm(.025)*std.error, 
                    ymax = estimate + qnorm(.975)*std.error,
                    color = "95%"),
                width = 0.2,
                size = 0.8) + 
  geom_errorbar(aes(ymin = estimate + qnorm(.05)*std.error, 
                    ymax = estimate + qnorm(.95)*std.error,
                    color = "90%"),
                width = 0.2,
                size = 1.2) + 
  geom_errorbar(aes(ymin = estimate + qnorm(.1)*std.error, 
                    ymax = estimate + qnorm(.9)*std.error,
                    color = "80%"),
                width = 0.2,
                size = 1.6) 
```

---
```{r show-p}
p
```

---
```{r add-legend-p, eval = FALSE}
p + 
  scale_color_manual("Confidence Interval",
                     values = c("#4375D3",
                                lighten("#4375D3", .3),
                                lighten("#4375D3", .6))) +
  geom_point() +
  coord_flip()

```

---
```{r add_legend-eval, echo = FALSE, fig.height = 9}
ggplot(tidied_m, aes(term, estimate)) +
  geom_hline(yintercept = 0,
             color = "cornflowerblue",
             linetype = 2) +
  geom_errorbar(aes(ymin = estimate + qnorm(.025)*std.error, 
                    ymax = estimate + qnorm(.975)*std.error,
                    color = "95%"),
                width = 0.2,
                size = 0.8) + 
  geom_errorbar(aes(ymin = estimate + qnorm(.05)*std.error, 
                    ymax = estimate + qnorm(.95)*std.error,
                    color = "90%"),
                width = 0.2,
                size = 1.2) + # 90% CI
  geom_errorbar(aes(ymin = estimate + qnorm(.1)*std.error, 
                    ymax = estimate + qnorm(.9)*std.error,
                    color = "80%"),
                width = 0.2,
                size = 1.6) + # 80% CI
  scale_color_manual("Confidence Interval",
                     values = c("#4375D3",
                                lighten("#4375D3", .3),
                                lighten("#4375D3", .6))) +
  geom_point() +
  coord_flip()
```

---
# Density stripes

```{r density-stripes, fig.height = 5.5}
#remotes::install_github("wilkelab/ungeviz")
library(ungeviz)
ggplot(tidied_m, aes(estimate, term)) +
  stat_confidence_density(
    aes(moe = std.error),
    fill = "#4375D3",
    height = 0.6
  ) +
  xlim(-10, 35) +
  geom_point()
```

---
# Actual densities

```{r densities, fig.height = 4.5}
library(ggridges)
ggplot(tidied_m, aes(estimate, term)) +
  stat_confidence_density(
    aes(moe = std.error, height = stat(density)),
    geom = "ridgeline",
    confidence = 0.95,
    min_height = 0.001,
    alpha = 0.7,
    fill = "#4375D3"
  ) +
  xlim(-10, 35) 
```

---
# Practice

* Go back to your species means from Palmer Penguins

* Reproduce the plot using one of the three methods we just saw

  + Multiple error bars
  + Density stripes
  + Densities

`r countdown(minutes = 5, seconds = 0)`

---
class: inverse-blue center middle
# HOPs
### Hypothetical Outcome Plots (and related plots)

---
# Standard regression plot

```{r loess1}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  geom_smooth()
```

---
# Alternative

```{r bootstrap1, echo = FALSE}
samps <- rerun(
  100,
  sample(seq_len(nrow(mtcars)), nrow(mtcars), replace = TRUE)
)

d_samps <- map_df(samps, ~mtcars[.x, ], .id = "sample")

ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  geom_smooth(
    aes(group = sample), 
    data = d_samps, 
    se = FALSE,
    color = "#4375D3",
    fullrange = TRUE,
    size = 0.1
  )
```

---
# How?
### Bootstrapping

```{r bootstrap2a}
row_samps <- replicate(
  100,
  sample(
    seq_len(nrow(mtcars)),
    nrow(mtcars),
    replace = TRUE
  ),
  simplify = FALSE
)

row_samps
```

---
# Extract samples
```{r bootstrap2b}
d_samps <- map_df(row_samps, ~mtcars[.x, ], .id = "sample")
head(d_samps)
tail(d_samps)
```

---
# Plot both data sources

```{r bootstrap2c-echo, eval = FALSE}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  stat_smooth(
    aes(group = sample),
    data = d_samps,
    geom = "line",
    color = "#4375D3",
    fullrange = TRUE,
    size = 0.1
  )
```

---
```{r bootstrap2c-eval, echo = FALSE, fig.height = 9}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  stat_smooth(
    aes(group = sample),
    data = d_samps,
    geom = "line",
    color = "#4375D3",
    fullrange = TRUE,
    size = 0.1
  )
```

---
# Note, they match up
```{r bootstrap2d-echo, eval = FALSE}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  geom_smooth(color = "magenta") +
  stat_smooth(
    aes(group = sample),
    data = d_samps,
    geom = "line",
    color = "#4375D3",
    fullrange = TRUE,
    size = 0.1
  )
```

---
```{r bootstrap2d-eval, echo = FALSE, fig.height = 9}
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  geom_smooth(color = "magenta") +
  stat_smooth(
    aes(group = sample),
    data = d_samps,
    geom = "line",
    color = "#4375D3",
    fullrange = TRUE,
    size = 0.1
  )
```

---
# HOPs
Hops animate the process, so you can't settle on one "truth"

```{r hop1, echo = FALSE, eval = FALSE}
library(gganimate)
animated_p <- ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  stat_smooth(
    data = d_samps,
    geom = "line",
    size = 2,
    color = "#4375D3",
    fullrange = TRUE
  ) +
  transition_states(
    sample,
    transition_length = 0.5,
    state_length = 0.5
  ) +
  ease_aes('linear') +
  theme_minimal(25)

animate(animated_p, fps = 5, width = 800)
anim_save(here::here("static", "slides", "img", "loess_hop.gif"))
```

![](img/loess_hop.gif)


---
# How?
`gganimate::transition_states`

```{r gganimate, eval = FALSE}
library(gganimate)
ggplot(mtcars, aes(disp, mpg)) +
  geom_point() +
  stat_smooth(
    data = d_samps,
    geom = "line",
    size = 2,
    color = "#4375D3",
    fullrange = TRUE
  ) +
  transition_states(
    sample, 
    transition_length = 0.5,
    state_length = 0.5
  ) +
  ease_aes('linear') # Smoother transitions
```

---
# Another example

![](https://github.com/wilkelab/ungeviz/raw/master/man/figures/README-cacao-samples-anim-1.gif)

---
# Another examples
### From Dr. Kay again

<div style="text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/E1kSnWvqCw0?start=2380" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>

---
# Conclusions
* Lots of tools at your disposal (perhaps so many it can be difficult to choose)

* Do try to communicate uncertainty whenever possible


--
* I'd recommend checking out [Clause Wilke's talk](https://resources.rstudio.com/rstudio-conf-2019/visualizing-uncertainty-with-hypothetical-outcomes-plots) from `rstudio::conf(2019L)`, where he talks about the [ungeviz](https://github.com/wilkelab/ungeviz) package.


---
class: inverse-orange middle

# Break

`r countdown(minutes = 5, seconds = 0)`

---
class: inverse-blue middle

# Tables

```{css echo = FALSE}
table {
	font-size: 1rem;
}
.rt-table {
  font-size: 0.9rem;
}
.rt-pagination {
  font-size: 0.9rem;
}
.rt-search {
  font-size: 0.9rem;
}
```

---
class: inverse-green
background-image:url(https://github.com/rstudio/gt/raw/master/man/figures/logo.svg?sanitize=TRUE)
background-size: contain

---
# Overview
* Pipe-oriented

* Beautiful tables easy

* Spanner heads/grouping used to be a total pain - not so anymore

* Renders to HTML/PDF without even thinking about it

--

Probably my favorite package for creating static tables, although [**kableExtra**](https://haozhu233.github.io/kableExtra/) is great too.

My experience is that fewer people are generally familiar with [**gt**](https://gt.rstudio.com), which is why I cover it here.

---
# Install

```{r install-gt, eval = FALSE}
install.packages("gt")

# or

remotes::install_github("rstudio/gt")
```

Please follow along

`r countdown(minutes = 1, seconds = 0)`

---
# The hard part
* Getting your data in the format you want a table in

* Utilize your `pivot_*` skills regularly

```{r flying}
library(fivethirtyeight)
flying
```

---

```{r }
flying %>% 
  count(gender, age, recline_frequency) 
```

---
```{r }
smry <- flying %>% 
  count(gender, age, recline_frequency) %>% 
  drop_na(age,recline_frequency) %>% 
  pivot_wider(names_from = "age", 
              values_from = "n") 
smry
```

---
# Turn into table

```{r gt1-echo, eval = FALSE}
library(gt)
smry %>% 
  gt()
```

--
## Disclaimer: these all look slightly different on the slides

The way they look for you locally is how they will render in standard R Markdown files

---
class: middle

```{r gt1-eval, echo = FALSE}
library(gt)
smry %>% 
  gt()
```


---
## Add gender as a grouping variable


```{r gt2-echo, eval = FALSE}
smry %>% 
  group_by(gender) %>% #<<
  gt()
```

---
class: middle

```{r gt2-eval, echo = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt()
```

--

This is an example of a table that looks better with the default CSS

---
# Add a spanner head

```{r gt3-echo, eval = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner( #<<
    label = "Age Range", #<<
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`) #<<
  ) #<<
```

---
class: middle

```{r gt3-eval, echo = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  )
```

---
# Change column names

```{r gt4-echo, eval = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  cols_label(recline_frequency = "Recline") #<<
```

---
class: middle

```{r gt4-eval, echo = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  cols_label(recline_frequency = "Recline")
```

---
# Align columns

```{r gt4-aligned-echo, eval = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", #<<
             columns = vars(recline_frequency)) #<<
```

---
class: middle 

```{r gt4-aligned-eval, echo = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(label = "Age Range",
              columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", columns = vars(recline_frequency))
```

---
# Add a title


```{r gt4-title-echo, eval = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left",
             columns = vars(recline_frequency)) %>%
  tab_header( #<<
    title = "Airline Passengers", #<<
    subtitle = "Leg space is limited, what do you do?" #<<
  ) #<<
```


---
class: middle

```{r gt4-title-eval, echo = FALSE}
smry %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(label = "Age Range",
              columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", columns = vars(recline_frequency)) %>% 
  tab_header(title = "Airline Passengers",
             subtitle = "Leg space is limited, what do you do?")
```

---
# Format columns

```{r gt5-echo, eval = FALSE}
smry %>% 
  mutate(across(c(`18-29`, `30-44`, `45-60`, `> 60`), #<<
                ~.x/100)) %>% #<<
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  fmt_percent( #<<
    vars(`18-29`, `30-44`, `45-60`, `> 60`), #<<
    decimals = 0 #<<
  ) %>% #<<
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", 
             columns = vars(recline_frequency)) %>% 
  tab_header(
    title = "Airline Passengers",
    subtitle = "Leg space is limited, what do you do?"
  )
```

---
class: middle 

```{r gt5-eval, echo = FALSE}
smry %>% 
  mutate_at(vars(`18-29`, `30-44`, `45-60`, `> 60`), ~./100) %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(label = "Age Range",
              columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)) %>% 
  fmt_percent(vars(`18-29`, `30-44`, `45-60`, `> 60`),
              decimals = 0) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", columns = vars(recline_frequency)) %>% 
  tab_header(title = "Airline Passengers",
             subtitle = "Leg space is limited, what do you do?")
```

---
# Add a source note

```{r gt6-echo, eval = FALSE}
smry %>% 
  mutate(across(c(`18-29`, `30-44`, `45-60`, `> 60`),
                ~.x/100)) %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(
    label = "Age Range",
    columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)
  ) %>% 
  fmt_percent(
    vars(`18-29`, `30-44`, `45-60`, `> 60`), 
    decimals = 0 
  ) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", 
             columns = vars(recline_frequency)) %>% 
  tab_header(
    title = "Airline Passengers",
    subtitle = "Leg space is limited, what do you do?"
  ) %>% 
  tab_source_note( #<<
    source_note = md("Data from [fivethirtyeight](https://fivethirtyeight.com/features/airplane-etiquette-recline-seat/)") #<<
  ) #<<
```

---
class: middle

```{r gt6-eval, echo = FALSE}
smry %>% 
  mutate_at(vars(`18-29`, `30-44`, `45-60`, `> 60`), ~./100) %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(label = "Age Range",
              columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)) %>% 
  fmt_percent(vars(`18-29`, `30-44`, `45-60`, `> 60`),
              decimals = 0) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  cols_align(align = "left", columns = vars(recline_frequency)) %>% 
  tab_header(title = "Airline Passengers",
             subtitle = "Leg space is limited, what do you do?") %>% 
  tab_source_note(source_note = md("Data from [fivethirtyeight](https://fivethirtyeight.com/features/airplane-etiquette-recline-seat/)"))
```

---
# Color cells
```{r gt7-echo, eval = FALSE}
... %>% 
  data_color(
    vars(`18-29`, `30-44`, `45-60`, `> 60`),
    colors = scales::col_numeric(
      palette = c("#FFFFFF", "#FF0000"),
      domain = NULL
    )
  ) %>%
  ...
```

---
class: middle

```{r gt7-eval, echo = FALSE}
smry %>% 
  mutate_at(vars(`18-29`, `30-44`, `45-60`, `> 60`), ~./100) %>% 
  group_by(gender) %>% 
  gt() %>% 
  tab_spanner(label = "Age Range",
              columns = vars(`18-29`, `30-44`, `45-60`, `> 60`)) %>% 
  fmt_percent(vars(`18-29`, `30-44`, `45-60`, `> 60`),
              decimals = 0) %>% 
  cols_label(recline_frequency = "Recline") %>% 
  data_color(vars(`18-29`, `30-44`, `45-60`, `> 60`),
             colors = scales::col_numeric(palette = c(c("#FFFFFF", "#FF0000")), domain = NULL)) %>% 
  cols_align(align = "left", columns = vars(recline_frequency)) %>% 
  tab_header(title = "Airline Passengers",
             subtitle = "Leg space is limited, what do you do?") %>% 
  tab_source_note(source_note = md("Data from [fivethirtyeight](https://fivethirtyeight.com/features/airplane-etiquette-recline-seat/)"))
```

---
# What else?
* Lots more it can do, and lots more in development
* See the [website](https://gt.rstudio.com)


--
[Thomas Mock](https://twitter.com/thomas_mock) does a lot of great work with
tables and often has tutorials showing your how to go further (e.g., see
[here](https://themockup.blog/posts/2020-10-31-embedding-custom-features-in-gt-tables/) and [here](https://themockup.blog/posts/2020-09-26-functions-and-themes-for-gt-tables/) and [here](https://themockup.blog/posts/2020-09-04-10-table-rules-in-r/)).

---
class: inverse-red center middle

# A few other table options


---
# kableExtra
### A few quick examples
Make sure to specify `results = "asis"` in your chunk options.

.pull-left[

```{r kableExtra1-echo, eval = FALSE, results = "asis"}
library(knitr)
library(kableExtra)
dt <- mtcars[1:5, 1:6]
kable(dt) %>%
  kable_styling("striped") %>%
  column_spec(5:7, bold = TRUE)
```

]

.pull-right[

```{r kableExtra1-eval, echo = FALSE, results = "asis"}
library(knitr)
library(kableExtra)
dt <- mtcars[1:5, 1:6]
kable(dt) %>%
  kable_styling("striped") %>%
  column_spec(5:7, bold = TRUE)
```

]
---
```{r kableExtra2, results = "asis"}
kable(dt) %>%
  kable_styling("striped") %>%
  column_spec(5:7, bold = TRUE) %>% 
  row_spec(c(2, 4), 
           bold = TRUE, 
           color = "#EFF3F7", 
           background = "#71B0DE")
```

---
```{r kableExtra3, results = "asis"}
kable(dt) %>%
  kable_styling("striped", full_width = FALSE) %>%
  pack_rows(
    "Group 1", 1, 3,
    label_row_css = "background-color: #666; color: #fff;"
  ) %>% 
  pack_rows(
    "Group 2", 4, 5,
    label_row_css = "background-color: #666; color: #fff;"
  )
```


---
# KableExtra wrapup
Many other options, please see the documentation. Works well for PDF and HTML.


--
What about Microsoft Word?

---
# flextable

[![](img/flextable.png)](https://davidgohel.github.io/flextable/index.html)


---
# Many others
* [huxtable](https://hughjonesd.github.io/huxtable/)
* [formattable](https://renkun-ken.github.io/formattable/)
* [DT](https://rstudio.github.io/DT/) (my former favorite for [shiny](https://shiny.rstudio.com))
* [rhandsontable](https://jrowen.github.io/rhandsontable/)


--
### Particularly helpful for modeling
* [stargazer](https://www.jakeruss.com/cheatsheets/stargazer/)
* [pixiedust](https://github.com/nutterb/pixiedust)
* [modelsummary](https://github.com/vincentarelbundock/modelsummary)


--
### For descriptives
* [gtsummary](https://github.com/ddsjoberg/gtsummary)

---
class: inverse-red middle
# reactable
My favorite for interactive tables

---

[![](img/reactable.png)](https://glin.github.io/reactable/index.html)

Works great with [**shiny**](https://shiny.rstudio.com) too

---
# Penguins data

```{r }
library(reactable)
reactable(penguins)
```

---
# Rename columns

```{r eval = FALSE}
penguins %>% 
  reactable(
    columns = list(
      bill_length_mm = colDef(name = "Bill Length (mm)"),
      bill_depth_mm = colDef(name = "Bill Depth (mm)")
    )
  )
```

---
```{r echo = FALSE}
penguins %>% 
  reactable(
    columns = list(
      bill_length_mm = colDef(name = "Bill Length (mm)"),
      bill_depth_mm = colDef(name = "Bill Depth (mm)")
    )
  )
```

---
# Or use a function

```{r eval = FALSE}
library(stringr)

penguins %>% 
  reactable(
    defaultColDef = colDef(
      header = function(x) str_to_title(gsub("_", " ", x))
    )
  )
```

---
```{r echo = FALSE}
library(stringr)

penguins %>% 
  reactable(
    defaultColDef = colDef(
      header = function(x) str_to_title(gsub("_", " ", x))
    )
  )
```

---
# Add filter

```{r}
reactable(penguins, filterable = TRUE)
```

---
# Searchable

```{r}
reactable(penguins, searchable = TRUE)
```

---
# Pagination

```{r}
reactable(penguins, defaultPageSize = 3)
```

---
# Page jump

```{r}
reactable(penguins, 
          defaultPageSize = 3, 
          paginationType = "jump")
```

---
# Grouping

```{r}
reactable(penguins, groupBy = c("species", "island"))
```

---
# Aggregate

```{r}
penguins %>% 
  reactable(
    groupBy = c("species", "island"),
    columns = list(
      bill_length_mm = colDef(aggregate = "mean", 
                              format = colFormat(digits = 2))
    )
  )
```

---
# Sparklines

```{r }
library(sparkline)
table_data <- penguins %>% 
  group_by(species) %>% 
  summarize(bill_length = list(bill_length_mm)) %>% 
  mutate(boxplot = NA,
         sparkline = NA)
table_data
```

---

```{r eval = FALSE}
table_data %>% 
  reactable(
    columns = list(
      bill_length = colDef(cell = function(value) {
        sparkline(value, type = "bar")
      }),
      boxplot = colDef(cell = function(value, index) {
        sparkline(table_data$bill_length[[index]], type = "box")
      }),
      sparkline = colDef(cell = function(value, index) {
        sparkline(table_data$bill_length[[index]])
      })
    )
  )
```

---
```{r echo = FALSE}
table_data %>% 
  reactable(
    columns = list(
      bill_length = colDef(cell = function(value) {
        sparkline(value, type = "bar")
      }),
      boxplot = colDef(cell = function(value, index) {
        sparkline(table_data$bill_length[[index]], type = "box")
      }),
      sparkline = colDef(cell = function(value, index) {
        sparkline(table_data$bill_length[[index]])
      })
    )
  )
```

---
# Lots more!
Idea of today is not to teach you everything, but to give you an idea of what's
possible. Check out the [documentation]() for more information.

---
class:inverse-blue center middle
# Fonts

---
# General advice
* Match your plot fonts to your text body font

* Use different fonts to distinguish things 
    + Specifically code
    + Consider different fonts for different heading levels, and/or to distinguish headers from the body

* **Always** choose a sans-serif font for code

* Explore and try - it makes a big impact on the overall look/feel (bigger than
you may expect if you haven't played with fonts much before)

* Try not to get sucked into too deep of a rabbit hole


---
# {ragg}

Alternative device to Cairo, png, etc.

See the announcement [here](https://www.tidyverse.org/blog/2021/02/modern-text-features/)

After install, be sure to set *Global Options > General > Graphics* to *AGG*

Use with RMarkdown with `knitr::opts_chunk$set(dev = "ragg_png")`

Will automatically detect fonts you have installed on your computer

---

```{r extrafont-plot}
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point() +
  labs(title = "Fuel Efficiency of 32 Cars",
       x = "Weight (x1000 lb)",
       y = "Miles per Gallon") +
  theme(text = element_text(family = "Luminari", size = 30)) #<<
```


---
# Support for lots of things!
Ligatures and font-awesome icons

```{r eval = FALSE}
library(ragg)

ggplot() + 
  geom_text(
    aes(x = 0, y = 2, label = "x <- y != z"), 
    family = "Fira Code"
  ) +
  labs(title = "twitter") +
  theme(
    plot.title = element_text(
      family = "Font Awesome 5 brands"
    )
  )
```

---
```{r echo = FALSE}
library(ragg)

ggplot() + 
  geom_text(
    aes(x = 0, y = 2, label = "x <- y != z"),
    size = 25,
    family = "Fira Code"
  ) +
  labs(title = "twitter") +
  theme(
    plot.title = element_text(
      family = "Font Awesome 5 brands"
    )
  )
```

---
# emojis

```{r }
ggplot(mtcars, aes(disp, mpg)) +
  geom_text(label = "üéâ",
            family = "Apple Color Emoji",
            size = 10)
```

---
# Google fonts

https://fonts.google.com

* Open source, designed for the web

* Good place to explore fonts

* Can be incorporated via the `{showtext}` package!

---
# {showtext} example

```{r showtext1-echo, eval = FALSE}
devtools::install_github("yixuan/showtext")

library(showtext)

font_add_google('Monsieur La Doulaise', "mld")
font_add_google('Special Elite', "se")

showtext_auto()
quartz()

ggplot(mtcars, aes(disp, mpg)) +
  geom_point() + 
  labs(title = "An amazing title", 
       subtitle = "with the world's most boring dataset") + 
  theme(plot.subtitle = element_text(size = 18, family = "se"), #<<
        plot.title = element_text(size = 22, family = "mld"), #<<
        axis.title = element_text(size = 18, family = "mld"), #<<
        axis.text.x = element_text(size = 12, family = "se"), #<<
        axis.text.y = element_text(size = 12, family = "se")) #<<
```


---
background-image:url("img/font-change.png")
background-size: contain


---
# Practice

* Create a simple plot

* Change the font to something on your computer (e.g., "Times New Roman")

* Try importing and using a google font with **showtext**

* Try using different fonts for the title and subtitle

`r countdown(minutes = 5, seconds = 0)`

---
class: inverse-blue center middle
# Why fonts matter
### A few examples of epic fails
h/t [Will Chase](https://twitter.com/W_R_Chase)

---
# Megaflicks

.center[
![](https://pbs.twimg.com/media/CGwg2F3XIAAQpRA?format=jpg&name=small)
]

---
background-image: url(https://i.redd.it/38jjcgaqu1g11.jpg)

---
background-image: url(img/always-mine.png)

---
# Quick aside
### Change the font of your R Markdown!

Create a CSS code chunk - write tiny bit of CSS - voila!

```{css, eval = FALSE}
@import url('https://fonts.googleapis.com/css?family=Akronim&display=swap');

body {
  font-family: 'Akronim', cursive;
}
```

We'll talk about this more next week.


---
# Render!

![](img/font-change-rmd.png)

---
# Aside

I actually did this for these slides to make the tables a bit smaller!

![](img/css-chunk.png)

---
# Resource for learning more
* I'm not an expert on fonts. I have mostly just picked what looks nice to me.

* Consider the accesibility of the font ([good resource here](https://venngage.com/blog/accessible-fonts/))

--

.center[

```{r, out.width = "475px", echo = FALSE}
knitr::include_graphics("https://www.exopermaculture.com/wp-content/uploads/2013/01/alice-falling-down-rabbit-hole1.jpeg")
```

]

---
Best I've heard of is [practical typography](https://practicaltypography.com)
![](img/practical-typography.png)

---
# Identify fonts

Use others work to help you - I found the font for these slides from a different theme that I liked.

Use google chrome's developer tools to help!


---
class: inverse-green middle

# Next time: Dashboards, websites, etc.